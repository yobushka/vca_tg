# vca2telegram ‚Äî ONVIF VCA ‚Üí Telegram

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ ONVIF-—Å–æ–±—ã—Ç–∏—è –∫–∞–º–µ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram —Ñ–æ—Ç–æ –∏ –∫–æ—Ä–æ—Ç–∫–∏–π –≤–∏–¥–µ–æ–∫–ª–∏–ø –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ VCA (Motion/Intrusion/Line –∏ –¥—Ä.).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ ONVIF Events (PullPoint) –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–µ—Ä—ã.
- –§–∏–ª—å—Ç—Ä –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (topics_filter) –∏ –∏–≥–Ω–æ—Ä-–ª–∏—Å—Ç (ignore_filter).
- –ü–æ–¥–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä–æ—Ç–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä –∏ –¥–µ—Ç–∞–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: rule=‚Ä¶, analytics=‚Ä¶, source=‚Ä¶, srcval=‚Ä¶.
- –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è —Å–Ω–∏–º–∫–∞: —Ä–∏—Å—É–µ—Ç bbox –æ–±—ä–µ–∫—Ç–∞ (–µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –ø—Ä–∏—Å–ª–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã).
- –ö–ª–∏–ø –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ffmpeg –∏–∑ RTSP (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å–∞–±–ø–æ—Ç–æ–∫).

–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –∑–∞–º–µ—Ç–∫–∏: —Å–º. docs/REFERENCE.md

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
```powershell
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env ‚Äî —É–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ chat_id

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞–º–µ—Ä
cp .config.yaml.example app/config.yaml
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ app/config.yaml ‚Äî –¥–æ–±–∞–≤—å—Ç–µ IP, –ª–æ–≥–∏–Ω—ã, –ø–∞—Ä–æ–ª–∏ –∫–∞–º–µ—Ä
```

### 2. Telegram Bot Setup
1) –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram ‚Üí –ø–æ–ª—É—á–∏—Ç–µ `TELEGRAM_BOT_TOKEN`
2) –ù–∞–π–¥–∏—Ç–µ chat_id:
   - –î–ª—è –ª–∏—á–Ω–æ–≥–æ —á–∞—Ç–∞: –Ω–∞–ø–∏—à–∏—Ç–µ @userinfobot ‚Äî –æ–Ω –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à ID
   - –î–ª—è –≥—Ä—É–ø–ø—ã: –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @getidsbot
   - –î–ª—è –∫–∞–Ω–∞–ª–∞: —Å–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞
3) –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:
```bash
TELEGRAM_BOT_TOKEN=123456789:AABBCCDDxxxxxxxxxxxxxxxxxxx
TELEGRAM_CHAT_ID=-1001234567890
DEBUG=1
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–º–µ—Ä
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app/config.yaml`:
```yaml
cameras:
  - name: entrance
    ip: 192.168.1.31
    username: admin
    password: your-camera-password
    profile: 0

topics_filter:
  - Motion          # –¥–µ—Ç–µ–∫—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
  - Human           # –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞
  - Intrusion       # –≤—Ç–æ—Ä–∂–µ–Ω–∏–µ
  - Line            # –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ª–∏–Ω–∏–∏
  - Cross           # –∫—Ä–æ—Å—Å-–¥–µ—Ç–µ–∫—Ü–∏—è

ignore_filter:
  - Bandwidth       # –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```

### 4. –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```powershell
docker compose down -t 1
docker compose build
docker compose up
```

### 5. –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
**–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:**
```
vca-onvif  | Started 3 camera listeners.
vca-onvif  | [entrance] Device: UNIVIEW C1L-2WN FW IPC_D1211...
vca-onvif  | [entrance] ONVIF subscription OK. Listening for events...
```

**–ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è:**
```
vca-onvif  | [entrance] Event topic: Message ... Name=IsMotion Value=true
vca-onvif  | [entrance] Event matched ‚Üí sending Telegram...
```

**–í Telegram –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:**
- –§–æ—Ç–æ —Å –±–æ–∫—Å–∞–º–∏ (–µ—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤)
- –ü–æ–¥–ø–∏—Å—å: `üìπ entrance [Motion] @ 2025-08-11 12:34:56 rule=MyMotionDetectorRule source=video_source_config1`
- –í–∏–¥–µ–æ–∫–ª–∏–ø (10 —Å–µ–∫, mp4)

### 6. –û—Ç–ª–∞–¥–∫–∞
**–í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:**
```bash
DEBUG=1
CAP_TEST=1  # –ø–æ–∫–∞–∑–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
```

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- `Skipped (no filter match)` ‚Äî —Å–æ–±—ã—Ç–∏–µ –Ω–µ –ø—Ä–æ—à–ª–æ —Ñ–∏–ª—å—Ç—Ä `topics_filter`
- `snapshot failed: 401` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∫–∞–º–µ—Ä—ã
- `Error: Connection refused` ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∫–∞–º–µ—Ä—ã –∏ —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VCA –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∫–∞–º–µ—Ä—ã

**–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```yaml
topics_filter: []  # –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
```

Windows/macOS: host-—Å–µ—Ç—å –≤ Docker Desktop –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞; —Ç–µ–∫—É—â–∏–π compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `network_mode: host` –¥–ª—è Linux. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ç—å/–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`app/config.yaml`)
- cameras: —Å–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä
  - name: –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∏–º—è (–≤ –ø–æ–¥–ø–∏—Å–∏)
  - ip, username, password
  - profile: –∏–Ω–¥–µ–∫—Å –ø—Ä–æ—Ñ–∏–ª—è –º–µ–¥–∏–∞ (0 ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- topics_filter: —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∞ —Å–æ–±—ã—Ç–∏—è (case-insensitive)
- ignore_filter: —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å—Ç—Ä–æ–∫ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏–≥–Ω–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Bandwidth)
- prefer_stream: –∏–Ω–¥–µ–∫—Å –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è RTSP –∫–ª–∏–ø–∞ (0=main, 1=sub1)

–ü—Ä–∏–º–µ—Ä:
```yaml
cameras:
  - name: cam1
    ip: 10.0.0.31
    username: admin
    password: pass

topics_filter:
  - Motion
  - Intrusion
ignore_filter:
  - Bandwidth
prefer_stream: 1
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- TELEGRAM_BOT_TOKEN ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- TELEGRAM_CHAT_ID ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- CLIP_SECONDS ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–ø–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- COOLDOWN_SECONDS ‚Äî –∞–Ω—Ç–∏—Ñ–ª—É–¥ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –æ—Ç –æ–¥–Ω–æ–π –∫–∞–º–µ—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
- DEBUG ‚Äî 1 –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `üìπ <cam> [Motion] @ 2025‚Äë08‚Äë11 12:34:56`.
- –î–µ—Ç–∞–ª–∏: `rule=MyMotionDetectorRule analytics=‚Ä¶ source=‚Ä¶ srcval=‚Ä¶ boxes=N`.
- –¢–µ–∫—Å—Ç: –ø–µ—Ä–≤—ã–µ ~180 —Å–∏–º–≤–æ–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ ONVIF-—Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- –§–æ—Ç–æ: snapshot —á–µ—Ä–µ–∑ HTTP (Basic/Digest auth, –±–µ–∑ user:pass –≤ URL).
- –í–∏–¥–µ–æ: ffmpeg ‚Üí mp4 –∏–∑ RTSP, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Å–∞–±–ø–æ—Ç–æ–∫.

## –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –°–æ–±—ã—Ç–∏—è Bandwidth/RecordingJob —à—É–º—è—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ignore_filter`.
- Motion –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–µ—Ç –±–æ–∫—Å–æ–≤ ‚Äî –Ω–µ –≤—Å–µ –∫–∞–º–µ—Ä—ã –ø—Ä–∏—Å—ã–ª–∞—é—Ç ROI/bbox –≤ ONVIF.
- 401 –Ω–∞ snapshot ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º HTTP Basic/Digest, –Ω–µ –≤–∫–ª–∞–¥—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª—å –≤ URL.

## –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥
- –í–∫–ª—é—á–∏—Ç–µ DEBUG=1, —Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ `Event topic:` –∏ `Skipped‚Ä¶` —Å –∫—Ä–∞—Ç–∫–∏–º –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º.
- –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π, –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–µ `topics_filter:` –∏ —Å–æ–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –ª–æ–≥–æ–≤.

## –õ–∏—Ü–µ–Ω–∑–∏—è
MIT


